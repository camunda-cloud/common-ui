import{Component,Host,h,Prop,Method,State,Element}from"@stencil/core";import{onThemeChange}from"../../globalHelpers";export class CmTextfield{constructor(){this.type="text",this.value="",this.label="",this.helperText="",this.showRequired=!1,this.placeholder="",this.autocomplete="",this.disabled=!1,this.maxLength=void 0,this.fieldPrefix={type:"default"},this.fieldSuffix={type:"default"},this.required=!1,this.validation={type:"default"},this.validationStyle="form",this.formName="",this.labelAlignment="vertical",this.isDirty=!1,this.showPassword=!1,this.forceRenderingOfValidationState=!1,this.forceHidingOfValidationState=!1,this.theme="Light",this.showCopyTooltip=!1,this.delayValidationDistance=1e3}componentWillLoad(){onThemeChange((theme=>{this.theme=theme}))}getNormalisedInputType(){return"multiline"===this.type?"text":this.type}async reset(){this.disabled||(this.value="",this.isDirty=!1,this.validationResult=void 0)}async forceFocus(){this.element.shadowRoot.querySelector("input, textarea").focus()}checkDefaultValidity(){let result;if(""!==this.value||this.required){let validationInput=document.createElement("input");validationInput.type=this.getNormalisedInputType(),validationInput.value=this.value,validationInput.required=this.required,validationInput.maxLength=this.maxLength,result=validationInput.checkValidity()?{isValid:!0}:{isValid:!1,type:"invalid",message:validationInput.validationMessage}}else result={isValid:!0};return result}async checkValidity(){let result;return result=this.checkDefaultValidity(),"default"!==this.validation.type&&result.isValid&&(result=await this.validation.validator(this.value)),result}async renderValidity(){this.validationResult=await this.checkValidity(),this.forceRenderingOfValidationState=!0,this.forceHidingOfValidationState=!1}async hideValidity(){this.forceRenderingOfValidationState=!1,this.forceHidingOfValidationState=!0}resetValidationForces(){this.forceHidingOfValidationState=!1,this.forceRenderingOfValidationState=!1}renderLabelContainer(){return h("div",{class:"labelContainer"},h("div",{class:"label"},this.label),"vertical"===this.labelAlignment?h("cm-text",{appearance:"helperText",color:"subtle"},this.helperText):"","vertical"===this.labelAlignment&&this.showRequired?h("cm-text",{appearance:"helperText",color:"subtle",class:"requiredStatus"},this.required?"Required":"Optional"):"")}renderPrefix(){return"multiline"===this.type?"":"text"===this.fieldPrefix.type?h("div",{class:"prefix text"},this.fieldPrefix.value):"icon"===this.fieldPrefix.type?h("div",{class:"prefix icon"},h("cm-icon",{icon:this.fieldPrefix.icon})):"default"!==this.fieldPrefix.type||"text"!==this.type&&"password"!==this.type&&"email"!==this.type?void 0:h("div",{class:"prefix empty"})}renderInputElement(){const inputHandler=async event=>{if(this.resetValidationForces(),this.isDirty=!0,this.value=event.target.value,"form"===this.validationStyle)this.validationResult&&!this.validationResult.isValid&&(this.validationResult=await this.checkValidity());else if("delay"===this.validationStyle){this.delayedValidationTimer&&clearTimeout(this.delayedValidationTimer);let validity=await this.checkValidity();!0===validity.isValid?this.renderValidity():"incomplete"===validity.type?(this.forceHidingOfValidationState=!0,this.delayedValidationTimer=setTimeout((()=>{this.renderValidity()}),this.delayValidationDistance)):this.renderValidity()}else this.renderValidity()};if("multiline"===this.type)return h("textarea",{tabIndex:0,disabled:this.disabled,value:this.value,placeholder:this.placeholder,maxlength:this.maxLength,onInput:inputHandler});{let type=this.type;return"password"===type&&this.showPassword&&(type="text"),h("input",{tabIndex:0,disabled:this.disabled,type,value:this.value,placeholder:this.placeholder,maxlength:this.maxLength,onInput:inputHandler})}}renderSuffix(){if("multiline"===this.type)return"";if("text"===this.fieldSuffix.type)return h("div",{class:"suffix text"},this.fieldSuffix.value);if("icon"===this.fieldSuffix.type)return h("div",{class:"suffix icon"},h("cm-icon",{icon:this.fieldSuffix.icon}));if("maxlength"===this.fieldSuffix.type)return h("div",{class:"suffix maxlength"},this.value.length,"/",this.maxLength);if("copy"===this.fieldSuffix.type)return h("div",{class:"suffix copy"},h("div",{class:{tooltip:!0,hidden:!this.showCopyTooltip}},"Copied"),h("cm-icon",{icon:"copy",onMouseDown:event=>{event.preventDefault()},onClick:event=>{event.preventDefault(),navigator.clipboard.writeText(this.value).then((()=>{this.showCopyTooltip=!0,setTimeout((()=>{this.showCopyTooltip=!1}),3e3)}),(()=>{console.error("Copy to clipboard has failed")}))}}));if("default"===this.fieldSuffix.type){if("text"===this.type||"email"===this.type)return h("div",{class:"suffix empty"});if("password"===this.type)return this.showPassword?h("div",{class:"suffix password"},h("cm-icon",{icon:"hide",onMouseDown:event=>{event.preventDefault()},onClick:()=>{this.showPassword=!1}})):h("div",{class:"suffix password"},h("cm-icon",{style:{transform:"translateY(.42px)"},"tab-index":"-1",icon:"show",onMouseDown:event=>{event.preventDefault()},onClick:()=>{this.showPassword=!0}}))}}renderAsyncStatusIndicator(){return h("div",{class:"asyncStatusIndicator"})}renderErrorMessage(){var _a;return!this.isDirty&&!this.forceRenderingOfValidationState||this.forceHidingOfValidationState?h("div",{class:"errorMessage"}):!1===(null===(_a=this.validationResult)||void 0===_a?void 0:_a.isValid)?h("div",{class:"errorMessage"},h("cm-icon",{color:"danger",icon:"warning"}),this.validationResult.message):h("div",{class:"errorMessage"})}render(){return h(Host,{onBlur:()=>{"delay"===this.validationStyle&&this.renderValidity()}},h("label",{class:{container:!0,[this.theme]:!0,[this.labelAlignment]:!0,hasError:this.validationResult&&!this.validationResult.isValid&&!this.forceHidingOfValidationState,disabled:this.disabled}},this.renderLabelContainer(),h("div",{class:"inputContainer"},this.renderPrefix(),this.renderInputElement(),this.renderAsyncStatusIndicator(),this.renderSuffix()),this.renderErrorMessage()))}static get is(){return"cm-textfield"}static get encapsulation(){return"shadow"}static get originalStyleUrls(){return{$:["cm-textfield.scss"]}}static get styleUrls(){return{$:["cm-textfield.css"]}}static get properties(){return{type:{type:"string",mutable:!0,complexType:{original:"InputType",resolved:'"email" | "multiline" | "password" | "text"',references:{InputType:{location:"local"}}},required:!1,optional:!1,docs:{tags:[],text:""},attribute:"type",reflect:!0,defaultValue:"'text'"},value:{type:"string",mutable:!0,complexType:{original:"string",resolved:"string",references:{}},required:!1,optional:!1,docs:{tags:[],text:""},attribute:"value",reflect:!1,defaultValue:"''"},label:{type:"string",mutable:!0,complexType:{original:"string",resolved:"string",references:{}},required:!1,optional:!1,docs:{tags:[],text:""},attribute:"label",reflect:!0,defaultValue:"''"},helperText:{type:"string",mutable:!0,complexType:{original:"string",resolved:"string",references:{}},required:!1,optional:!1,docs:{tags:[],text:""},attribute:"helper-text",reflect:!0,defaultValue:"''"},showRequired:{type:"boolean",mutable:!0,complexType:{original:"boolean",resolved:"boolean",references:{}},required:!1,optional:!1,docs:{tags:[],text:""},attribute:"show-required",reflect:!0,defaultValue:"false"},placeholder:{type:"string",mutable:!0,complexType:{original:"string",resolved:"string",references:{}},required:!1,optional:!1,docs:{tags:[],text:""},attribute:"placeholder",reflect:!0,defaultValue:"''"},autocomplete:{type:"string",mutable:!0,complexType:{original:"HTMLInputElement['autocomplete']",resolved:"string",references:{HTMLInputElement:{location:"global"}}},required:!1,optional:!1,docs:{tags:[],text:""},attribute:"autocomplete",reflect:!1,defaultValue:"''"},disabled:{type:"boolean",mutable:!0,complexType:{original:"boolean",resolved:"boolean",references:{}},required:!1,optional:!1,docs:{tags:[],text:""},attribute:"disabled",reflect:!1,defaultValue:"false"},maxLength:{type:"number",mutable:!0,complexType:{original:"| number\n\t\t| undefined",resolved:"number",references:{}},required:!1,optional:!1,docs:{tags:[],text:""},attribute:"maxlength",reflect:!1,defaultValue:"undefined"},fieldPrefix:{type:"unknown",mutable:!0,complexType:{original:"FieldPrefix",resolved:'{ type: "default"; } | { type: "icon"; icon: "check" | "close" | "closeLarge" | "contextMenu" | "copy" | "delete" | "document" | "down" | "edit" | "email" | "external" | "help" | "hide" | "information" | "left" | "minus" | "plus" | "right" | "search" | "show" | "sort" | "stop" | "up" | "warning"; } | { type: "text"; value: string; }',references:{FieldPrefix:{location:"local"}}},required:!1,optional:!1,docs:{tags:[],text:""},defaultValue:"{\n\t\ttype: 'default',\n\t}"},fieldSuffix:{type:"unknown",mutable:!0,complexType:{original:"FieldSuffix",resolved:'{ type: "copy"; } | { type: "default"; } | { type: "icon"; icon: "check" | "close" | "closeLarge" | "contextMenu" | "copy" | "delete" | "document" | "down" | "edit" | "email" | "external" | "help" | "hide" | "information" | "left" | "minus" | "plus" | "right" | "search" | "show" | "sort" | "stop" | "up" | "warning"; } | { type: "maxlength"; } | { type: "text"; value: string; }',references:{FieldSuffix:{location:"local"}}},required:!1,optional:!1,docs:{tags:[],text:""},defaultValue:"{\n\t\ttype: 'default',\n\t}"},required:{type:"boolean",mutable:!0,complexType:{original:"boolean",resolved:"boolean",references:{}},required:!1,optional:!1,docs:{tags:[],text:""},attribute:"required",reflect:!1,defaultValue:"false"},validation:{type:"unknown",mutable:!0,complexType:{original:"| { type: 'default' }\n\t\t| {\n\t\t\t\ttype: 'custom'\n\t\t\t\tvalidator: (value: string) => Promise<ValidatorResult>\n\t\t  }",resolved:'({ type: "custom"; validator: (value: string) => Promise<ValidatorResult>; }) | { type: "default"; }',references:{Promise:{location:"global"},ValidatorResult:{location:"import",path:"../../globalHelpers"}}},required:!1,optional:!1,docs:{tags:[],text:""},defaultValue:"{\n\t\ttype: 'default',\n\t}"},validationStyle:{type:"string",mutable:!0,complexType:{original:"| 'form'\n\t\t| 'live'\n\t\t| 'delay'",resolved:'"delay" | "form" | "live"',references:{}},required:!1,optional:!1,docs:{tags:[],text:""},attribute:"validation-style",reflect:!1,defaultValue:"'form'"},formName:{type:"string",mutable:!0,complexType:{original:"string",resolved:"string",references:{}},required:!1,optional:!1,docs:{tags:[],text:""},attribute:"form-name",reflect:!0,defaultValue:"''"},labelAlignment:{type:"string",mutable:!0,complexType:{original:"| 'horizontal'\n\t\t| 'vertical'",resolved:'"horizontal" | "vertical"',references:{}},required:!1,optional:!1,docs:{tags:[],text:""},attribute:"label-alignment",reflect:!0,defaultValue:"'vertical'"}}}static get states(){return{isDirty:{},validationResult:{},showPassword:{},forceRenderingOfValidationState:{},forceHidingOfValidationState:{},theme:{},showCopyTooltip:{}}}static get methods(){return{reset:{complexType:{signature:"() => Promise<void>",parameters:[],references:{Promise:{location:"global"}},return:"Promise<void>"},docs:{text:"",tags:[]}},forceFocus:{complexType:{signature:"() => Promise<void>",parameters:[],references:{Promise:{location:"global"},HTMLInputElement:{location:"global"},HTMLTextAreaElement:{location:"global"}},return:"Promise<void>"},docs:{text:"",tags:[]}},checkValidity:{complexType:{signature:"() => Promise<ValidatorResult>",parameters:[],references:{Promise:{location:"global"},ValidatorResult:{location:"import",path:"../../globalHelpers"}},return:"Promise<ValidatorResult>"},docs:{text:"",tags:[]}},renderValidity:{complexType:{signature:"() => Promise<void>",parameters:[],references:{Promise:{location:"global"}},return:"Promise<void>"},docs:{text:"",tags:[]}},hideValidity:{complexType:{signature:"() => Promise<void>",parameters:[],references:{Promise:{location:"global"}},return:"Promise<void>"},docs:{text:"",tags:[]}}}}static get elementRef(){return"element"}}